Sub Edge_FullHTML_Headless_Wait()
    Dim b As AutomateBrowser
    Dim html As String
    Dim evt As Dictionary

    Set b = New_AutomateBrowser

    ' Launch Edge headless
    b.launch whichBrowser:=browserType.Edge, _
             additionnalInlineCommands:="--headless=new --disable-gpu", _
             killWithoutAsking:=True

    ' Enable Page domain and navigate
    b.cdp.Page.enable
    b.cdp.Page.navigate "https://www.google.com/"

    ' Block until load event is fired
    Do
        Set evt = b.cdp.peakMessage
        If Not evt Is Nothing Then
            If evt.Exists("method") Then
                If evt("method") = "Page.loadEventFired" Then Exit Do
            End If
        End If
        DoEvents
    Loop

    ' Now the DOM should be complete â€“ grab full HTML
    html = CStr(b.jsEval("document.documentElement.outerHTML"))
    Debug.Print html

    b.Quit
End Sub
