Option Explicit

Private gBrowser As AutomateBrowser

Sub FetchMultipleSitesHTML()
    Dim sites As Variant
    Dim site As Variant
    Dim targetId As String
    Dim sessionId As String
    Dim evalRes As Dictionary
    Dim html As String
    
    sites = Array("https://example.com", _
                  "https://en.wikipedia.org/wiki/Kitten", _
                  "https://httpbin.org/html")
    
    ' Launch Edge once
    Set gBrowser = New_AutomateBrowser
    gBrowser.launch whichBrowser:=browserType.Edge, _
                    url:="about:blank", _
                    killWithoutAsking:=True
    
    ' Enable runtime so we can evaluate
    gBrowser.cdp.Runtime.enable
    
    ' Loop through each site
    For Each site In sites
        Debug.Print "=== Opening: " & site & " ==="
        
        ' Open a new tab
        targetId = gBrowser.cdp.Target.createTarget(site)
        sessionId = gBrowser.cdp.Target.attachToTarget(targetId, True)
        
        ' Wait a moment for load (quick + dirty)
        Application.Wait (Now + TimeValue("0:00:03"))
        
        ' Confirm which tab weâ€™re in
        Set evalRes = gBrowser.cdp.Runtime.evaluate("window.location.href", sessionId)
        Debug.Print "Attached URL: " & evalRes("result")("value")
        
        ' Grab HTML in this tab
        Set evalRes = gBrowser.cdp.Runtime.evaluate("document.documentElement.outerHTML", sessionId)
        html = evalRes("result")("value")
        
        ' Print output (first 300 chars for readability)
        Debug.Print Left(html, 300) & vbCrLf & "..."
        
        ' Close the tab
        gBrowser.cdp.Target.closeTarget targetId
    Next site
    
    ' Quit browser at the end
    gBrowser.Quit
    Set gBrowser = Nothing
    
    Debug.Print "=== Done fetching all sites ==="
End Sub
